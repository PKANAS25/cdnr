 

<?php $__env->startSection('urlTitles'); ?>
<?php session(['title' => 'Clients']);
session(['subtitle' => '']); ?>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>

<link rel="stylesheet" type="text/css" href="/dist/msgbox/jquery.msgbox.css" />
<script type="text/javascript" src="/dist/msgbox/jquery.msgbox.min.js"></script>

<div id="content" class="content">
            <!-- begin breadcrumb -->
            <ol class="breadcrumb pull-right">
                <li><a href="javascript:;">Clients</a></li>
                <li><a href="javascript:;">Profile</a></li>
                 
            </ol>
            <!-- end breadcrumb -->
            <!-- begin page-header -->
            <h1 class="page-header">Client Profile <small> </small></h1>
            <!-- end page-header -->
            <!-- begin profile-container -->
            <div class="profile-container">
                <!-- begin profile-section -->
                <div class="profile-section">
                    <!-- begin profile-left -->
                    <div class="profile-left">
                        <!-- begin profile-image -->
                        <div class="profile-image">
                            <img src="<?php echo $profile_pic; ?>" />
                            <i class="fa fa-user hide"></i>
                        </div>
                        <!-- end profile-image -->
                         
                        <!-- begin profile-highlight -->
                         

                        <div>
                            <div class="checkbox m-b-5 m-t-0">
                            <?php if(Auth::user()->hasRole('ContactAdd')): ?>
                                <a href="<?php echo e(action('ContactsController@add',base64_encode($client->id))); ?>" class="btn btn-inverse btn-xs m-r-5"><i class="fa fa-user"></i> New Contact</a>  
                             <?php else: ?>
                             <a href="#" class="btn btn-default btn-xs m-r-5"><i class="fa fa-user"></i> New Contact</a>   
                            <?php endif; ?>    
                            </div> 

                            
                            <div class="checkbox m-b-5 m-t-0">
                                <a href="<?php echo e(action('CallsController@add',base64_encode($client->id))); ?>" class="btn btn-warning btn-xs m-r-5"><i class="fa fa-phone"></i> New Call</a>  
                            </div> 
 
                            <div class="checkbox m-b-5 m-t-0">
                                <?php if(Auth::user()->hasRole('ClientAdd')): ?>
                                <a href="<?php echo e(action('ClientsController@edit',base64_encode($client->id))); ?>" class="btn btn-success btn-xs m-r-5"><i class="fa fa-edit"></i> Edit Profile</a> 
                                <?php else: ?> 
                                <a href="#" class="btn btn-default btn-xs m-r-5"><i class="fa fa-edit"></i> Edit Profile</a> 
                                <?php endif; ?>
                            </div> 
                        </div>

                     
                        <!-- end profile-highlight -->
                    </div>
                    <!-- end profile-left -->
                    <!-- begin profile-right -->
                    <div class="profile-right">
                        <!-- begin profile-info -->
                        <div class="profile-info">
                            <!-- begin table -->
                            <div class="table-responsive">
                            <?php if(session('status')): ?>
                                        <div class="alert alert-success">
                                            <?php echo e(session('status')); ?>   
                                        </div>
                                    <?php endif; ?>
                                <table class="table table-profile table-striped">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>
                                                <h4><?php echo e($client->name); ?> <small><?php echo $client->industryName; ?></small></h4>
                                            </th>
                                        </tr>
                                    </thead> 

                                    <tbody>
                                        <tr class="highlight">
                                            <td class="field">Status</td>
                                            <td><?php echo e($client->currentStatus); ?></td>
                                        </tr>
                                        
                                        <tr>
                                            <td class="field">BD Grade</td>
                                            <td><?php echo e($client->bdGrade); ?></td>
                                        </tr>
                                        <tr>
                                            <td class="field">Parent Company</td>
                                            <td>
                                            <?php if($client->parentCompany): ?>
                                            <a href="<?php echo e(action('ClientsController@profile',base64_encode($client->parent_company))); ?>"><?php echo e($client->parentCompany); ?></a> 
                                            <?php else: ?> None 
                                            <?php endif; ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="field">Description</td>
                                            <td><?php echo e($client->description); ?></td>
                                        </tr>
                           
             
                                        <tr class="highlight">
                                            <td class="field">URL</td>
                                            <td><?php if($client->url): ?><a target="_blank" href="<?php echo e($client->url); ?>">Link</a> <?php else: ?> Not Available <?php endif; ?></td>
                                        </tr>
                                        
                                        <tr>
                                            <td class="field">Phone</td>
                                            <td>
                                                <i class="fa fa-mobile fa-lg m-r-5"></i> <?php echo e($client->phone); ?>

                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="field">Country</td>
                                            <td><?php echo e($client->countryName); ?></td>
                                        </tr>
                                        <tr>
                                            <td class="field">City</td>
                                            <td><?php if($client->city): ?> <?php echo e($client->cityName); ?> <?php else: ?> Multiple Cities <?php endif; ?></td>
                                        </tr>
                                        <tr>
                                            <td class="field">Address</td>
                                            <td><?php echo e($client->address); ?></td>
                                        </tr>
                                        <tr>
                                            <td class="field">Postal Code</td>
                                            <td><?php echo e($client->postal_code); ?></td>
                                        </tr>
                                        <tr>
                                            <td class="field">Subsidiaries</td>
                                            <td>
                                            <?php $flag=0;?>
                                            <?php foreach($subsidiaries AS $subsidiary): ?>
                                            <a href="<?php echo e(action('ClientsController@profile',base64_encode($subsidiary->id))); ?>"><?php echo e($subsidiary->name); ?></a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <?php $flag++;?>
                                            <?php endforeach; ?>
                                            <?php if(!$flag): ?>  None  <?php endif; ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" align="right">
                                        Added by <?php echo e($client->addedBy); ?> on <?php echo e(date('d-M-Y',strtotime($client->created_at))); ?> at <?php echo e(date('h:i:a',strtotime($client->created_at))); ?> 
                                            </td>
                                        </tr>

                                         
                                   
                                    </tbody>
                                </table>
                            </div>
                            <!-- end table -->
                        </div>
                        <!-- end profile-info -->
                    </div>
                    <!-- end profile-right -->
                </div>
                <!-- end profile-section -->
                 
                  </div><br>

            <!-- end profile-container --> 
                    <!-- begin row -->
                    <div class="row">
                        <!-- begin col-4 -->
                        <div class="col-md">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#default-tab-1" data-toggle="tab"><i class="fa fa-user"></i> Contacts</a></li>
                        <li class=""><a href="#default-tab-2" data-toggle="tab"><i class="fa fa-phone"></i> Call History</a></li>
                        <li class=""><a href="#default-tab-3" data-toggle="tab"><i class="fa fa-history"></i> Edit History</a></li> 
                        <li class=""><a href="#default-tab-4" data-toggle="tab"><i class="fa fa-trash"></i> Deleted Contacts</a></li>
                    </ul>
                    <div class="tab-content">
                        
                        
                        <div class="tab-pane fade active in" id="default-tab-1">
                         <div class="panel-body">
                         <table id="data-table" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                    <th class="nosort">#</th>
                                    <th>Name</th>
                                    <th>Position</th> 
                                    <th>Mobile</th> 
                                    <th>Phone</th> 
                                    <th>Email</th>
                                    <th>Notes</th> 
                                    <th>Added</th> 
                                    <th> </th> 
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php foreach($contacts AS $index => $contact): ?>
                                    <tr>
                                    <td><?php echo e($index+1); ?></td>
                                    <td>
                                    <div class="navbar-user">
                                    <?php if($contact->pic): ?><img src="/uploads/contactPics/<?php echo e($contact->id); ?>.jpg" alt="" /><?php endif; ?> 
                                    <?php if(Auth::user()->hasRole('ContactAdd')): ?>
                                    <a href="<?php echo e(action('ContactsController@edit',[base64_encode($client->id),base64_encode($contact->id)])); ?>"><?php echo e($contact->name); ?></a>
                                    <?php else: ?>
                                    <?php echo e($contact->name); ?>

                                    <?php endif; ?>
                                    </div>
                                    </td>
                                    <td><?php echo e($contact->desig); ?></td>
                                    <td><?php echo e($contact->mobile); ?></td>
                                    <td><?php echo e($contact->phone); ?> <?php if($contact->phone2): ?> , <?php echo e($contact->phone2); ?> <?php endif; ?></td>
                                    <td><?php echo e($contact->email); ?></td>
                                    <td><?php echo e($contact->notes); ?></td>
                                    <td><?php echo e($contact->admin); ?></td>
                                    <td>
                                    <?php if(Auth::user()->hasRole('ContactAdd')): ?>
                                    <div id="delDiv<?php echo e($contact->id); ?>">
                                    <button class="btn btn-xs" id="deleteContact<?php echo e($contact->id); ?>" value="<?php echo e($contact->id); ?>"> <i class="fa fa-trash text-danger"></i></button>
                                    </div>
                                    <script type="text/javascript">
                                                    $(document.body).on('click', '#deleteContact<?php echo e($contact->id); ?>', function(e){
                                                        e.preventDefault();
                                                        id = $(this).val(); 
                                                         $.post('/deleteClientContact',{id:id,_token:'<?php echo e(csrf_token()); ?>' }, function(actionBlade){ 
                                                            $("#delDiv<?php echo e($contact->id); ?>").html(actionBlade); 
                                                        });
                                                    });
                                    </script>                
                                    <?php endif; ?>
                                    </td>
                                    </tr>
                                    <?php endforeach; ?>
                                    </tbody>
                                    </table>
                            </div>
                            </div>
                      
      <!----------------------------------------------------Call History------------------------------------------------------------------------------- -->                
                      
                        <div class="tab-pane fade" id="default-tab-2">
                        <div class="panel-body">
                        


                       <table id="data-table2" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                    <th class="nosort">#</th>
                                    <th>Contacted Person</th>
                                    <th>Call Time</th>
                                    <th>Call Details</th>  
                                    <th>Staff</th>
                                    <th> </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php foreach($calls AS $index => $call): ?>
                                    <tr>
                                    <td><?php echo e($index+1); ?></td>
                                    <td <?php if($call->importance==1): ?> class="text-warning" <?php elseif($call->importance==2): ?> class="text-success" <?php elseif($call->importance==3): ?> class="text-danger" <?php endif; ?>><?php echo e($call->contactName.$call->contact_person); ?></td>
                                    <td><?php echo e(date('d-M-y H:i:a',strtotime($call->call_time))); ?></td>
                                    <td><?php echo $call->call_details; ?></td>
                                    <td><?php echo e($call->admin); ?></td>
                                    <td><?php if( ( $call->added_by == Auth::id() && date('Y-m-d',strtotime($call->created_at))==date('Y-m-d') ) || Auth::user()->hasRole('Superman') ): ?>
                                            <a href="<?php echo e(action('CallsController@edit',[base64_encode($client->id),base64_encode($call->id)])); ?>"><i class="fa fa-edit text-success"></i></a>
                                            &nbsp;&nbsp;&nbsp;&nbsp;
                                           
                                            <button id="callDel<?php echo e($index); ?>"><i  class="fa fa-trash text-danger"></i></button>
                                                 <script type="text/javascript">
                                                    $('#callDel<?php echo e($index); ?>').click(function(ev) {
                                                    
                                                      $.msgbox("<p>Are you sure you want to delete this?</p>", {
                                                        type    : "prompt",
                                                         inputs  : [
                                                          {type: "hidden", name: "_token", value: "<?php echo e(csrf_token()); ?>"}  
                                                        ],
                                                         
                                                        buttons : [
                                                          {type: "submit", name: "delete", value: "Delete"},
                                                          {type: "cancel", value: "Cancel"}
                                                        ],
                                                        form : {
                                                          active: true,
                                                          method: 'post',
                                                          action: '<?php echo e(action('CallsController@delete',[base64_encode($call->client),base64_encode($call->id)])); ?>'
                                                        }
                                                      });
                                                      
                                                      ev.preventDefault();
                                                    
                                                    });
                                                 </script>
                                     <?php endif; ?></td>
                                    </tr>
                                    <?php endforeach; ?>
                                    </tbody>
                                    </table>
                                    <span class="text-warning"><i class="fa fa-circle"></i> Important</span>&nbsp;&nbsp;&nbsp;&nbsp;  
                                    <span class="text-success"><i class="fa fa-circle"></i> Casual</span>&nbsp;&nbsp;&nbsp;&nbsp; 
                                    <span class="text-danger"><i class="fa fa-circle"></i> Rejection</span>&nbsp;&nbsp;&nbsp;&nbsp;
                                    </div>
                            
                        </div>
                        
              <!-----------------------------------------------------Edit History------------------------------------------------------------------------------ -->          
                        
                        <div class="tab-pane fade" id="default-tab-3">
                             
                           <div class="panel-body">  
                            <table id="data-table3" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                    <th class="nosort">#</th>
                                    <th>Date</th> 
                                    <th>Changes</th>
                                    <th>Admin</th> 
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php foreach($changes AS $index => $change): ?>
                                    <tr>
                                    <td><?php echo e($index+1); ?></td>
                                    <td><?php echo e(date('d-M-Y',strtotime($change->dated))); ?> at <?php echo e(date('h:i:a',strtotime($change->dated))); ?> </td>
                                    <td><?php echo $change->changes; ?></td>
                                    <td><?php echo e($change->addedBy); ?></td>
                                    </tr>
                                    <?php endforeach; ?>
                                    </tbody>
                                    </table>
                             </div>
                             
                        </div>
                        
    <!------------------------------------------------------------Deleted Contacts----------------------------------------------------------------------- -->                    
                         
                      <div class="tab-pane fade" id="default-tab-4">
                            <div class="panel-body">
                             <table id="data-table" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                    <th class="nosort">#</th>
                                    <th>Name</th>
                                    <th>Position</th> 
                                    <th>Mobile</th> 
                                    <th>Phone</th> 
                                    <th>Email</th>
                                    <th>Notes</th> 
                                    <th>Deleted</th> 
                                    <th> </th> 
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php foreach($deletedContacts AS $index => $contact): ?>
                                    <tr>
                                    <td><?php echo e($index+1); ?></td>
                                    <td><?php echo e($contact->name); ?></td>
                                    <td><?php echo e($contact->desig); ?></td>
                                    <td><?php echo e($contact->mobile); ?></td>
                                    <td><?php echo e($contact->phone); ?> <?php if($contact->phone2): ?> , <?php echo e($contact->phone2); ?> <?php endif; ?></td>
                                    <td><?php echo e($contact->email); ?></td>
                                    <td><?php echo e($contact->notes); ?></td>
                                    <td><?php echo e($contact->admin); ?></td>
                                    <td>
                                    <?php if(Auth::user()->hasRole('ContactAdd')): ?>
                                    <div id="resDiv<?php echo e($contact->id); ?>">
                                    <button class="btn btn-xs" id="restoreContact<?php echo e($contact->id); ?>" value="<?php echo e($contact->id); ?>"> <i class="fa fa-rotate-left text-info"></i></button>
                                    </div>
                                    <script type="text/javascript">
                                                    $(document.body).on('click', '#restoreContact<?php echo e($contact->id); ?>', function(e){
                                                        e.preventDefault();
                                                        id = $(this).val(); 
                                                         $.post('/restoreClientContact',{id:id,_token:'<?php echo e(csrf_token()); ?>' }, function(actionBlade){ 
                                                            $("#resDiv<?php echo e($contact->id); ?>").html(actionBlade); 
                                                        });
                                                    });
                                    </script>                
                                    <?php endif; ?>
                                    </td>
                                    </tr>
                                    <?php endforeach; ?>
                                    </tbody>
                                    </table>
                        </div>
                        </div>
                      
                      
                    </div>
                     
                     
                </div>
                         
                    </div>
                    <!-- end row -->
                 
               
          
        </div>

        <script>
        $(document).ready(function() {
                                            
            $('#data-table2').dataTable( {
                "paging":   false,
                "ordering": true,
                "info":     false,
                "aaSorting": [],
                "columnDefs": [ {
                      "targets": 'nosort',
                      "bSortable": false,
                      "searchable": false
                    } ]
            } );
            

            $('#data-table3').dataTable( {
                "paging":   false,
                "ordering": true,
                "info":     false,
                "aaSorting": [],
                "columnDefs": [ {
                      "targets": 'nosort',
                      "bSortable": false,
                      "searchable": false
                    } ]
            } );

             $('#data-table4').dataTable( {
                "paging":   false,
                "ordering": true,
                "info":     false,
                "aaSorting": [],
                "columnDefs": [ {
                      "targets": 'nosort',
                      "bSortable": false,
                      "searchable": false
                    } ]
            } );

             } );

            </script>
        <?php $__env->stopSection(); ?>
<?php echo $__env->make('hrMaster', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>